---
title: Java基础（三）GC
date: 2018-03-24
tags: [Java, GC, 基础]
categories: [tech]
urlname: Java-GC
---
***

前言：主要记录了在学习JVM过程中对于GC的理解。
PS: 由于最近需要准备的东西比较多，如果单纯总结性写的话花的时间还少点，但大多数知识点是边学边记录，由此花费的时间十分地多，但自己又想写。。。所以只能是记录下思路和自己的发现，以后有时间再"丰满血肉"吧。。

![](https://image-1251774567.cosgz.myqcloud.com/blog/2018-04-04-steve-johnson-548313-unsplash_gaitubao_com_1985x1323%20-1-.jpg)

<!--more-->

>   GC指JVM自动回收内存的过程。强调，是在堆上。。

主要从三个方面理解GC：

-   审判
    JVM如何判定一个对象是无用的？
    
-   缓刑
    无用的对象最后的自救？

-   执行
    JVM如何回收已确定需要处理的对象？

每一个过程又分为理论与实际实现细节。

## 理论

### 审判

-   引用计数（循环引用问题）

-   可达性分析

-   什么是引用？Java中有哪些引用（JDK1.7之后引入强引用之外的三种）

    -   强引用（正常对象引用，存在则GC绝不会回收？真的吗）
    -   软引用（内存不够时回收掉）
    -   弱引用（内存够不够时下次GC都回收掉）
    -   虚引用（没什么用，只是GC掉时通知一下存有该引用的对象）

### 缓刑

-   finalize方法
    
    -   只能执行一次
    -   只能由GC执行时才有特殊功效
    -   可以在这个方法中"自救"
    -   整个finalize的过程，如F-Queue、F-unreadable状态
    
### 执行

简单来说：GC算法

-   复制回收
-   标记清除
-   标记整理

## 实际实现细节

### 审判

-   什么对象可以作GC Root（简单来说，就是活跃引用）
-   如何安全地进入可达性

    -   Safe Point
        
        以HotSpot VM为具体例子看题主的代码例子。HotSpot VM里，**解释执行**的方法可以在任意字节码边界上进入GC，但**JIT编译后的代码**并不能在“任意位置”进入GC。可以进入GC的“特定位置”叫做“GC safepoint”，或者简称“safepoint”。[这段 Java 代码中的局部变量能够被提前回收吗？编译器或 VM 能够实现如下的人工优化吗？](https://www.zhihu.com/question/34341582/answer/58444959)


    -   OopMap
    -   Safe Region

### 执行

简单来说：GC回收器

[深入理解JVM(3)——7种垃圾收集器](https://crowhawk.github.io/2017/08/15/jvm_3/)


## 补充

-   为什么GC要分代

    -   之前不能并行的时候，防止STW时间太长让用户不爽
    -   现在可以大部分并行的时候，是为了提高GC回收内存的速率

-   GC的触发

    [Major GC和Full GC的区别是什么？触发条件呢？](https://www.zhihu.com/question/41922036)    

